{% load static %}
<!DOCTYPE html>
<html>



<head>
  <meta charset="UTF-8">
  <title>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'products/styles.css' %}">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <script>
    function toggleSelectAll(source) {
      const checkboxes = document.getElementsByName('products');
      for (let checkbox of checkboxes) {
        checkbox.checked = source.checked;
      }
    }
  </script>
</head>

{% load dict_get %}
{% load custom_filters %}

{% if returntolist  %}
  <a href="{% url 'product_list' %}" class="button">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤</a>
{% endif %}

<form method="post" action="{% url 'update_from_inriver' %}" id="update-form" style="display:inline;">
  {% csrf_token %}
  
  <button type="submit" class="button" id="update-button">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏–∑ Inriver</button>
  <div id="loading-spinner" style="display: none; margin-left: 10px;">
    <div class="spinner"></div>
  </div>

  {% if has_qr_codes %}
  <a href="{% url 'download_all_qr' %}" class="button">üì¶ –°–∫–∞—á–∞—Ç—å –≤—Å–µ QR-–∫–æ–¥—ã (ZIP) </a>

  <a href="{% url 'delete_all_qr' %}" class="button" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ QR-–∫–æ–¥—ã?')">üóë –£–¥–∞–ª–∏—Ç—å –≤—Å–µ QR-–∫–æ–¥—ã</a>

  {% endif %}


</form>

{% if messages %}
  <div class="mt-2">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}


<form method="get">
    {{ filter.form.as_p }}
    <button type="submit">–§–∏–ª—å—Ç—Ä</button>
</form>

<form method="post" action="{% url 'generate_qr' %}">
  
  {% csrf_token %}

  {% if show_download_all %}

    <p>
      ‚úÖ QR-–∫–æ–¥—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.
      <a href="{% url 'download_all_qr' %}">
        üì¶ –°–∫–∞—á–∞—Ç—å –≤—Å–µ –∫–∞–∫ –∞—Ä—Ö–∏–≤
      </a>
    </p>
  {% endif %}
  

  <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã QR</h3>
  <label><input type="checkbox" name="include_barcode"  checked> –í–∫–ª—é—á–∏—Ç—å —à—Ç—Ä–∏—Ö-–∫–æ–¥</label><br><br>
  <button type="submit" class="button">üìé –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å QR –∫–æ–¥—ã</button>


  <table>
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleSelectAll(this)"> –í—Å–µ</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
        <th>–ì—Ä—É–ø–ø–∞</th>
        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
        <th>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å</th>
        <th>QR –∫–æ–¥</th>
      </tr>
    </thead>
    <tbody>
  {% for product in page_obj %}
  <tr>
    <td><input type="checkbox" name="products" value="{{ product.id }}"></td>
    <td>{{ product.name }}</td>
    <td>{{ product.barcode }}</td>
    <td>{{ product.group }}</td>
    <td>{{ product.created_at }}</td>
    <td>{{ product.show_on_site }}</td>
    <td>
  {% with  "qrcodes/"|add:product.name|add:".png" as png_path  %}
    {% if png_path|file_exists %}
      <a href="{% url 'download_qr' product.id %}" class="btn btn-sm btn-success">
        üì• –°–∫–∞—á–∞—Ç—å QR
      </a>
    {% else %}
      <span class="text-muted">QR –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</span>
    {% endif %}
  {% endwith %}
</td>

  </tr>
  {% endfor %}
</tbody>
<div style="margin-top: 20px;">
  <div>
    {% if page_obj.has_previous %}
      <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">‚è™ –ü–µ—Ä–≤–∞—è</a>
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">‚óÄÔ∏è –ù–∞–∑–∞–¥</a>
    {% endif %}

    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">–í–ø–µ—Ä—ë–¥ ‚ñ∂Ô∏è</a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ‚è©</a>
    {% endif %}
  </div>
</div>

  </table>

</form>

<script>
  const form = document.getElementById("update-form");
  const button = document.getElementById("update-button");
  const spinner = document.getElementById("loading-spinner");

  form.addEventListener("submit", function () {
    button.disabled = true;
    spinner.style.display = "inline-block";
    button.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
  });
</script>

</html>