{% load static %}
<!DOCTYPE html>
<html>



<head>
  <meta charset="UTF-8">
  <title>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'products/styles.css' %}">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <script>
    function toggleSelectAll(source) {
      const checkboxes = document.getElementsByName('products');
      for (let checkbox of checkboxes) {
        checkbox.checked = source.checked;
      }
    }
  </script>
</head>

{% load dict_get %}
{% load custom_filters %}

{% if returntolist  %}
  <a href="{% url 'product_list' %}" class="button">â† Return to the list of products</a>
{% endif %}

<form method="post" action="{% url 'update_from_inriver' %}" id="update-form" style="display:inline;">
  {% csrf_token %}
  
  <button type="submit" class="button" id="update-button">ğŸ”„ Update from Inriver</button>
  <div id="loading-spinner" style="display: none; margin-left: 10px;">
    <div class="spinner"></div>
  </div>
</form>

  {% if has_qr_codes %}
  <form method="post" action="{% url 'download_all_qr' %}" id="update-form" style="display:inline;">
  {% csrf_token %}
  
  <button type="submit" class="button" id="update-button">ğŸ“¦ Download all QR codes (ZIP)</button>
  <div id="loading-spinner" style="display: none; margin-left: 10px;">
    <div class="spinner"></div>
  </div>
</form>
<form method="post" action="{% url 'delete_all_qr' %}" id="update-form" style="display:inline;">
  {% csrf_token %}
  
  <button type="submit" class="button" id="update-button" onclick="return confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ QR-ĞºĞ¾Ğ´Ñ‹?')">ğŸ—‘ Delete all QR codes</button>
  <div id="loading-spinner" style="display: none; margin-left: 10px;">
    <div class="spinner"></div>
  </div>
</form>

  <!--<a href="{% url 'download_all_qr' %}" class="button" >ğŸ“¦ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²ÑĞµ QR-ĞºĞ¾Ğ´Ñ‹ (ZIP) </a>

  <a href="{% url 'delete_all_qr' %}" class="button" onclick="return confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ QR-ĞºĞ¾Ğ´Ñ‹?')">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ QR-ĞºĞ¾Ğ´Ñ‹</a>-->

  {% endif %}




{% if messages %}
  <div class="mt-2">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}


<form method="get">
    {{ filter.form.as_p }}
    <button type="submit">Filter</button>
</form>

<form method="post" action="{% url 'generate_qr' %}">
  
  {% csrf_token %}

  {% if show_download_all %}

    <p>
      âœ… QR codes generated.
      <a href="{% url 'download_all_qr' %}" id="update-button" >
        ğŸ“¦ Download everything as an archive
      </a>
    </p>
  {% endif %}
  

  <h3>QR Parameters</h3>
  <label><input type="checkbox" name="include_barcode"  checked> ADD barcode</label><br><br>
  <button type="submit" class="button">ğŸ“ Generate QR codes</button>


  <table>
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleSelectAll(this)"> Ğ’ÑĞµ</th>
        <th>Title</th>
        <th>inriver code</th>
        <th>Barcode</th>
        
       
        <th>QR ĞºĞ¾Ğ´</th>
      </tr>
    </thead>
    <tbody>
  {% for product in page_obj %}
  <tr>
    <td><input type="checkbox" name="products" value="{{ product.id }}"></td>
    <td>{{ product.name }}</td>
    <td>{{ product.external_id }}</td>
    <td>{{ product.barcode }}</td>
   
    <td>
  {% with  "qrcodes/"|add:product.name|add:".png" as png_path  %}
    {% if png_path|file_exists %}
      <a href="{% url 'download_qr' product.id %}" class="btn btn-sm btn-success">
        ğŸ“¥ Download QR
      </a>
    {% else %}
      <span class="text-muted">QR not generated</span>
    {% endif %}
  {% endwith %}
</td>

  </tr>
  {% endfor %}
</tbody>
<div style="margin-top: 20px;">
  <div>
    {% if page_obj.has_previous %}
      <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">âª first </a>
      <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">â—€ï¸ Back</a>
    {% endif %}

    <span>Page {{ page_obj.number }} Ğ¸Ğ· {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Next â–¶ï¸</a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Last  â©</a>
    {% endif %}
  </div>
</div>

  </table>

</form>

<script>
  const form = document.getElementById("update-form");
  const button = document.getElementById("update-button");
  const spinner = document.getElementById("loading-spinner");

  form.addEventListener("submit", function () {
    button.disabled = true;
    spinner.style.display = "inline-block";
    button.innerText = "Loading...";
  });
</script>

</html>